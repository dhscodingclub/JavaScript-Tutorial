<!DOCTYPE html>
<html style="scroll-behavior: smooth;">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- this is the code that will allow icon to be visible in the title bar of the brower -->
        <link rel="icon" type="image/ico" href="../js_icon.png" />
        <title>JavaScript Tutorial - DHS Coding Club</title>
        <!-- you can also say this:  <link rel="icon" type="image/png" href="location/image.png" /> -->
        <link rel="stylesheet" href="../StyleSheet.css">
        <!--Import the lessons function from lessons.js file-->
        <script src="./lesson.js"></script>
        <script src="./Constants.js"></script>
        <script src="./CookieCode.js"></script>
    </head>

    <body onload="checkCookie()" style="background: #f2f2f2;">
        <h1 class="center-text"><span
            style="background-color: rgb(255, 251, 0); padding-left: 5px; padding-right: 5px;">JavaScript Tutorial</span>
        </h1>
        <div id="mainBody">
            <div id="lessonKey"></div>
            <input type="text" id="keyEnter" value="" placeholder="Lesson Key" maxlength="100" style="border: 1px solid #ccc; border-radius: 5px; padding: 5px;"/>
            <button id="jump" style="display: inline;">Jump To Lesson</button>
            <button id="prev" style="display: inline; margin-left: 150px;">Previous Lesson</button>
            <button id="next" style="display: inline;">Next Lesson</button>
            <div id="lesson"></div>
            <div class="row" height=400px id="codeLandStuff">
                <div class="column" height=400px>
                    <textarea id="code" style="width: 90%; height:400px" spellcheck="false"></textarea>
                </div>
                <div id="right" class="column" height=400px>
                    <div><button id="run" style="width: 90%; height:10%; border-radius: 20px;">Run Code</button></div>
                    <h2 style="padding-bottom: 0px; font-size: 2vw;">Code Output Console</h2>
                    <div id="grade">
                        <p>Output from your code will show up in this console below.</p>
                        <p style="color: #f2f2f2">Incorrect<img src="../Fail.png" height=2vw style="visibility:hidden"></p>
                    </div>
                    <textarea id="ConsoleOutput" style="width: 100%; height: 230px;" disabled=true></textarea>
                </div>
            </div>
        </div>
    </body>
    <script>
        var rightC = document.getElementById("right");
        balanceColumns();
        function balanceColumns() {
            let code = document.getElementById("code");
            code.style.height = (rightC.offsetHeight - 15) + "px";
        }
        refreshLessonPage();
        let consoleLogs = [];
        var displayConsole = document.getElementById("ConsoleOutput");
        var inputCode = document.getElementById("code");
        //Redefine console.log function
        console.log = function (arg) {
            consoleLogs.push(arg);
        }
        let runner = document.getElementById("run");
        runner.addEventListener("click", () => {
            let codeValue = inputCode.value;
            evalAndReturn(codeValue);
            //console.log(codeValue); // <- This line is only for debugging; it breaks the code.
        });
        let previous = document.getElementById("prev");
        previous.addEventListener("click", () => {
            if (lessonNumber > 0) {
                lessonNumber--;
                console.log("lesson minused");
                refreshLessonPage();
                document.getElementById("next").style.display = "inline";
            }
            //The top lesson is not changed
        });
        let next = document.getElementById("next");
        next.addEventListener("click", () => {
            // lessonNumber++;
            // refreshLessonPage();
            if (lessonNumber < highestLesson) {
                lessonNumber++;
                refreshLessonPage();
            }
            //don't surpass the top lesson; that's cheatin'
        })
        let jumper = document.getElementById("jump");
        function checkKey() {
            for (let i = 0; i < lessonSkipCodes.length; i++) {
                if (lessonSkipCodes[i] == document.getElementById("keyEnter").value) {
                    //The key matches the lesson, so jump to that lesson
                    lessonNumber = i;
                    refreshLessonPage();
                    setCookie("lesson", lessonNumber, 365);
                    if (highestLesson < lessonNumber) {
                        //We have surpassed the tally
                        highestLesson = lessonNumber;
                    }
                }
            }
        }
        document.getElementById('code').addEventListener('keydown', function (e) {
            if (e.key == 'Tab') {
                e.preventDefault();
                var start = this.selectionStart;
                var end = this.selectionEnd;

                // set textarea value to: text before caret + tab + text after caret
                this.value = this.value.substring(0, start) +
                    "\t" + this.value.substring(end);

                // put caret at right position again
                this.selectionStart =
                    this.selectionEnd = start + 1;
            }
        });
        jumper.addEventListener("click", () => {
            checkKey();
        });
        function evalAndReturn(code) {
            displayConsole.value = "";
            let newItem = eval(code);
            for (let i = 0; i < consoleLogs.length; i++) {
                displayConsole.value += consoleLogs[i] + "\n";
            }
            checkWithAnswer(consoleLogs, code);
            consoleLogs = [];
            balanceColumns();
        }
        function nextLesson() {
            let Grade = document.getElementById("grade");
            Grade.innerHTML = `<p>Output from your code will show up in this console below.</p>
            <p style="color: white">Incorrect<img src="../Fail.png" height=15 style="visibility:hidden"></p>`;
            lessonNumber++;
            refreshLessonPage();
            //Automatically go to the top of the page
            window.location = "#";
            //Automatically clear the output console and input textarea
            displayConsole.value = "";
            inputCode.value = "";
            //update the cookie with the lesson number
            setCookie("lesson", lessonNumber, 365);
            if (highestLesson < lessonNumber) {
                //We have surpassed the tally
                highestLesson = lessonNumber;
            }
            balanceColumns();
        }
        function checkWithAnswer(codeOutput, rawCode) {
            let Grade = document.getElementById("grade");
            let allOutputsGood = true;
            for (let i = 0; i < desiredOutputs.length; i++) {
                if (desiredOutputs[lessonNumber][i] != codeOutput[i]) {
                    allOutputsGood = false;
                }
            }
            if (allOutputsGood == true) {
                //We have the desired output. Now, lets see if we have all of our desired keywords in the code.
                let allKeyWords = true;
                for (let i = 0; i < requiredKeywords[lessonNumber].length; i++) {
                    if (rawCode.indexOf(requiredKeywords[lessonNumber][i]) == -1) {
                        //we are missing the keyword
                        allKeyWords = false;
                        displayConsole.value += "\nLESSON FEEDBACK: \nmissing keyword " + requiredKeywords[lessonNumber][i];
                    } else {
                    }
                }
                if (allKeyWords == true) {
                    //We passed!
                    Grade.innerHTML = `<p>Congratulations, your code built successfully and had the correct output!</p><p><img src="../Checkmark.png" height=15><button onclick="nextLesson();">Next Lesson</button></p>`;
                } else {
                    displayConsole.value += `\n\nThe console output is correct, but you have not coded it properly. Please edit your code, making sure that you have followed all instructions, and try again. Taking "shortcuts" are not allowed for passing the lesson.`;

                    Grade.innerHTML = `<p>The inputted code is not complete.\nPlease edit your code and try again.</p> 
                <p style="color: red">Incorrect<img src="../Fail.png" height=15></p>`;
                }
            } else {
                Grade.innerHTML = `<p>The console output is not correct.\nPlease edit your code and try again.</p> 
                <p style="color: red">Incorrect<img src="../Fail.png" height=15></p>`;
            }
        }
        var myVar = setInterval(balanceColumns, 100);
    </script>

</html>
